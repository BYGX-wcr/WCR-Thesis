%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

%%
%% 使用 njuthesis 文档类生成南京大学本科生毕业论文的示例文档
%% 
%%

%% 
%% 南京大学本科学位论文模板
%% 2018年封面，摘要都发生了变化，本模板由以下2016年模板更改而来：http://haixing-hu.github.io/nju-thesis/

%% 如需Adobe字体请用（默认）
%\documentclass[adobefonts]{njuthesis}
%% MacOS系统请用
%\documentclass[macfonts]{njuthesis}
%% Windows系统请用
\documentclass[winfonts]{njuthesis}
%% Linux系统请用
%\documentclass[linuxfonts]{njuthesis}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 设置论文的中文封面
% 论文标题
\title{分析和仿真带权拥塞控制算法}

% 论文作者姓名
\author{吴昌容}
% 论文作者学号
\studentid{161220134}
% 导师姓名职称
\supervisor{田臣}
% 导师职称
\supervisortitle{副教授}
% 论文作者院系
\department{计算机科学与技术系}
% 论文作者专业方向
\major{计算机科学与技术}
% 论文作者的年级
\grade{2016级}
% 论文提交日期，需设置年、月、日。此属性可选，默认值为最后一次编译时的日期，精确到日。
\submitdate{2020年5月22日}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 设置论文的英文封面

% 论文的英文标题
\englishtitle{Simulation and Analysis of Weighted Congestion Control Algorithms}
% 论文作者姓名的拼音
\englishauthor{Changrong Wu}
% 导师姓名职称的英文
\englishsupervisor{Associate Professor Chen Tian}
% 论文作者所在院系的英文名称
\englishdepartment{Department of Computer Science and Technology}
% 论文作者所在学校或机构的英文名称。此属性可选，默认值为``Nanjing University''。
\englishinstitute{Nanjing University}
% 论文完成日期的英文形式，默认最后一次编译的时间
\englishdate{May 22, 2020}
% 专业
\englishinstitute{Computer Science and Technology}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 设置论文的页眉页脚
\usepackage{fancyhdr}
\pagestyle{fancy}
\lhead{\bfseries 161220134 }
\chead{分析和仿真带权拥塞控制算法}
\rhead{吴昌容}
\renewcommand{\headrulewidth}{0.4pt}
%\renewcommand{\footrulewidth}{0.4pt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

% 制作中文封面
\maketitle
% 制作英文封面
% \makeenglishtitle
% 毕业论文过程管理四页表
%\controlpage %可以将word文件交给老师签字后扫描转成pdf，然后命名为controlpage.pdf

% 论文的中文摘要
\begin{abstract}
  拥塞控制是传输层协议TCP（Transmission Control Protocol）的核心组成部分。一般的拥塞控制算法追求公平性，即希望能在每一条参与竞争的网络流中平均分配带宽。而带权拥塞控制（又称加权拥塞控制）算法则是普通拥塞控制算法的拓展，其试图用端到端的方式来在TCP流中按流的权重来分配带宽。计算机网络界的前辈们已经提出了两种著名的带权拥塞控制算法——MulTCP和EWTCP。由于基于加增乘减的拥塞控制算法的公平性最易于掌控，所以这两种算法均是希望通过调整TCP流的加增乘减机制来实现加权公平性。然而在科研实验中，我发现这些经典的加权拥塞控制算法并不总是能很好地按权重来分配带宽。事实上，在不同的环境条件下它们的表现会出现极大的区别。在本论文中，我将会呈现MulTCP和EWTCP两种加权拥塞控制算法的仿真实验结果，并分析其行为和性能变化。我会用实验数据说明加权拥塞控制算法的性能实际上会受到交换机缓冲区大小和链路传播时延的严重影响。最后，我总结出了这两种加权拥塞控制算法的表现随环境因素变化的规律。
% 同时应该注意到，空白页是故意留白，以便章节开头能够出现在偶数页。
% 中文关键词。关键词之间用中文全角分号隔开，末尾无标点符号。
\keywords{拥塞控制；带宽分配；加权公平性}
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 论文的英文摘要
\begin{englishabstract}
  Congestion Control is one of the critical components of TCP (Transmission Control Protocol). Normal congestion control algorithms aim to achieve fairness among all competing flows, which means they will try to allocate a fair share of the link capacity to each flow. Weighted congestion control algorithms are extensions of the normal versions. Basically speaking, weighted congestion control algorithms aim at using end-to-end mechanisms to allocate bandwidth proportionally according to flows’ weights. MulTCP and EWTCP are two representative schemes of weighted congestion control algorithms. Since the fairness of AIMD-based congestion control algorithms is most comprehensible, both of the schemes attempt to achieve weighted proportionality via modifying the behavior of AIMD (Additive Increase Multiplicative Decrease). However, in real experiments, I find that those weighted congestion control algorithms have variable performance in different circumstances. In fact, their performance with regard to weighted proportionality fluctuates drastically in various network environments. In this paper, I present the simulation results of MulTCP as well as EWTCP and analyze the variation of their behaviors and performance. I will show that both switch buffer size and propagation delay can significantly affect the performance of AIMD-based weighted congestion control algorithms, while these environmental parameters do not influence flows’ behaviors. Finally, I will conclude the pattern of weighted congestion control algorithms’ performance variation. 
% 英文关键词。关键词之间用英文半角逗号隔开，末尾无符号。
\englishkeywords{Congestion Control, Bandwidth Allocation, Weighted Fairness}
\end{englishabstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 论文的前言，应放在目录之前，中英文摘要之后
%
\begin{preface}

这是对我本科科研成果的一个提炼和总结。

\vspace{1cm}
\begin{flushright}
吴昌容
2020年5月22日于广西南宁
\end{flushright}

\end{preface}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 生成论文目录
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 生成插图清单。如无需插图清单则可注释掉下述语句。
%\listoffigures

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 生成附表清单。如无需附表清单则可注释掉下述语句。
%\listoftables

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 开始正文部分
\mainmatter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 学位论文的正文应以《绪论》作为第一章
\chapter{绪论}\label{chapter:intro}
\section{研究背景}
拥塞控制（Congestion Control）是传输层协议TCP（Transmission Control Protocol）的核心组成部分。
在TCP的整体控制系统中，拥塞控制担负着解决网络拥塞和避免丢包以提升网络性能的重要责任\cite{jacobson1988congestion}。
公平性是拥塞控制算法的主要性质之一，其要求拥塞控制算法能够在互相竞争的网络流中公平地分配带宽。
由于公平性不仅是个技术问题还是个社会问题，公平性从传输层控制协议（TCP）加入拥塞控制算法伊始，就一直为人们所关注。
在拥塞控制算法和理论发展的早期，人们主要关注如何才能使TCP拥塞控制算法达到公平性以及某种拥塞控制算法是否满足公平性的要求等问题\cite{chiu1989analysis}\cite{kelly1998rate}\cite{hasegawa1999fairness}。
但是随着网络的发展，在某些新的应用场景\cite{wischik2011design}\cite{Nathan2019wcubic}下，人们其实并不是希望公平地分配带宽而是希望能按权重来分配带宽。
因此，研究者们又进一步关注到了公平性的广义拓展——加权公平性。
具有加权公平性的拥塞控制算法就是带权拥塞控制或加权拥塞控制（Weighted Congestion Control）算法，这种算法根据每条网络流的权重来分配带宽。
由于基于加增乘减机制的拥塞控制算法的公平性最易于掌控和理解，最经典的两种带权拥塞控制算法MulTCP\cite{crowcroft1998differentiated}和EWTCP\cite{wischik2011design}也都是基于加增乘减机制的。
加增乘减（Additive Increase Multiplicative Decrease）机制是TCP协议拥塞控制的主要方法，它结合了线性探索和乘性退避的功能。
而且，加增乘减机制已经被证明可以保证每条参与竞争的TCP流都一定会收敛到公平的均衡点~\cite{chiu1989analysis}。
本文也将主要关注MulTCP和EWTCP这两种经典的基于加增乘减机制的带权拥塞控制算法。

\section{研究动机}

如今网络服务已经由free-use模型发展到pay-for-use模型，传统的公平性应当增强为加权公平性，以实现基于不同价格的差异化服务。
首先，为了支持日渐增多的异质化应用对网络带宽的不同要求，网络管理者往往需要在网络中为不同的流量配置优先级或权重\cite{Hong2013SWAN}。
拥有较高权重的流在竞争有限的带宽资源时，应该获得比权重较低的流更多的带宽。
其次，在数据中心中网络带宽应该按照每个租户支付的金钱来进行分配\cite{popa2012faircloud}。
如果一个租户支付了更高的服务费用，那么它理应获得更多的带宽。
带权拥塞控制正是一种可以用端到端的方式、简单高效地实现差异化服务的机制。
而且带权拥塞控制还可以从最细粒度的流一级上去控制带宽，并具有工作保留（Work-Conserving）的特性。
比如，如果能用带权拥塞控制来实现\cite{popa2012faircloud}中的带宽分配系统，那么将极大地提升系统的可拓展性，并降低交换机队列资源的消耗。
\cite{Nathan2019wcubic}中也正是使用带权拥塞控制来实现了更高粒度的用户体验质量（Quality of Experience）层级的公平性。
因此，我希望能够利用仿真和拟真实验来分析出带权拥塞控制的一些特性和规律，以便为带宽分配系统的设计提供指导。

\section{相关工作}

现有的支持网络带宽差异化分配的工作主要是利用交换机上的队列资源来对流量进行调度从而实现按权或按优先级分配带宽，比如Weighted Fair Queuing（WFQ）\cite{demers1989analysis}\cite{Abhay1993WFQ}和Diffserv\cite{Kathleen1998Diffserv}。
前几年提出的NUMFabric\cite{nagaraj2016numfabric}和Faircloud\cite{popa2012faircloud}均依赖于交换机上的WFQ来实现加权公平性。
功能日渐强大的交换机确实可以帮助实现加权公平性，但对交换机的依赖也使得这些系统的部署受到了限制。
由于网络节点总是要对网络的反馈作出回应，因此以加权拥塞控制为代表的端到端速率调整机制其实对于实现加权公平性更为普适和重要。
MulTCP\cite{crowcroft1998differentiated}和EWTCP\cite{wischik2011design}就是两种典型的基于AIMD的加权拥塞控制算法。
它们均通过在端上修改TCP拥塞控制的加增乘减机制来实现差异化带宽分配。
MulTCP根据锯齿模型分析得出的结论\cite{Floyd1997Sawtooth}提出：对于权重为$w$的TCP流，其加增参数和乘减参数应当分别为$w$和$1-\frac{1}{2w}$。
事实上MulTCP是存在问题的，因为其理论模型是基于每一条流拥塞窗口的变化均是高度同步这一假设的，而这个假设是不符合实际的。
EWTCP的设计想法则是来自于TCP流带宽随机测量模型\cite{padhye1998modeling}，对于权重为$w$的TCP流，它在普通加增乘减的基础上将加增的参数改为$w^2$。
EWTCP使用的模型在特定的情形下确实能够对单条TCP流的带宽进行较为准确地测量，但是这种模型没有将网络中动态变化的排队时延考虑进去。
因此，当交换机中队列的长度发生改变时，这种模型就会与现实产生偏差。
总的来说，MulTCP和EWTCP都只是提出了一种基于AIMD的加权拥塞控制算法，而这些算法都没有能够完美地实现加权公平性。
这主要是因为之前的这两份工作\cite{crowcroft1998differentiated}\cite{wischik2011design}都忽视了交换机缓冲区大小、传播时延和ACK选项对流的权重的影响。

\section{本文主要工作}
本文旨在对几种代表性的加权拥塞控制算法进行仿真和分析，以期总结出基于AIMD的加权拥塞控制算法的一些特性和规律，并最终提升人们对于加权拥塞控制算法的理解，帮助网络工程师们了解如何在实践中应用加权拥塞控制。本文的主要工作如下：
\begin{enumerate}
\item 对MulTCP和EWTCP进行仿真和拟真实验

\item 分析典型带权拥塞控制算法的表现

\item 总结基于AIMD的带权拥塞控制算法的加权公平性与环境变量之间的关系。
\end{enumerate}

% \section{本文结构}
% 本文的各章节组织结构如下：

% 第一章：绪论。
% 第二章：经典带权拥塞控制
% 第三章：仿真与分析
% 第四章：拟真实验验证
% 第五章：总结与讨论

\chapter{带权拥塞控制}\label{chapter:wcc}

在加权公平性模型下，当两条权重分别为$a_1, a_2$的使用加增乘减机制的TCP流共享一个容量为$C$的瓶颈链路时，它们分到的带宽应该分别为$\frac{a_1}{a_1 + a_2}C$和$\frac{a_2}{a_1 + a_2}C$，即在稳态下它们分到的带宽应当与他们的权重成比例。
这也正是带权拥塞控制算法在该例子中应该达到的效果，而普通拥塞控制算法的效果则可以看成这两条流权重均为1时的情况。
在这一节中，我将首先回顾一下两种代表性的带权拥塞控制算法MulTCP\cite{crowcroft1998differentiated}和EWTCP\cite{wischik2011design}，并提炼出它们设计思想的核心，并给出基于AIMD的带权拥塞控制算法的基本形式。

\begin{figure}[ht!]
  \centering
  \begin{subfigure}{.4\textwidth}
    \centering
      \includegraphics[width=1\textwidth]{MulTCP.pdf}
      \subcaption{两条共享同一链路权重分别为$a_1$和$a_2$的MulTCP流的加增乘减变化。}
      \label{fig:MulTCP}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{.4\textwidth}
    \centering
      \includegraphics[width=1\textwidth]{EWTCP.pdf}
      \subcaption{两条共享同一链路权重分别为$a_1$和$a_2$的EWTCP流的加增乘减变化。}
      \label{fig:EWTCP}
  \end{subfigure}
  \begin{subfigure}{.4\textwidth}
    \centering
      \includegraphics[width=1\textwidth]{WReno-AI.pdf}
      \subcaption{两条共享同一链路权重分别为$a_1$和$a_2$的WCC-AI流的加增乘减变化。}
      \label{fig:WReno-AI}
  \end{subfigure}
  \hspace{1em}
  \begin{subfigure}{.4\textwidth}
    \centering
      \includegraphics[width=1\textwidth]{WReno-MD.pdf}
      \subcaption{两条共享同一链路权重分别为$a_1$和$a_2$的WCC-MD流的加增乘减变化。}
      \label{fig:WReno-MD}
  \end{subfigure}
  \caption{几种基于加增乘减机制的典型带权拥塞控制算法运行抽象模拟图。图中每一条轴代表了一条TCP流0-1标准化后的窗口大小。蓝色实线（高效线）代表链路带宽用满，蓝色虚线（加权公平线）代表两条流权重成比例。}
  % Each axis corresponds to the window size of each source that is normalized to a number between 0 and 1 for convenience.
  % If the point colored red lies in the blue solid line, this represents that one unit capacity is fully utilized, \ie, the sum of the obtained bandwidth for two flows is equal to one.
  % 		If the point colored red lies in the blue dashed line, this indicates that the obtained bandwidth ratio for two flows is $a_1 : a_2$.
  % 		The intersection of the blue solid line and dashed line is the optimal point to achieve efficiency and weighted proportionality.
\label{fig:AIMD}
\end{figure}
% \begin{figure}[t]
% 		\begin{subfigure}{.5\textwidth}[The AIMD variations that two MulTCP flows with weight $a_1$ and $a_2$ share a single bottleneck link of capacity one.]{
% 			\label{fig:MulTCP}
%       \includegraphics[width=0.9\textwidth]{figure/MulTCP.pdf}}
%     \end{subfigure}
% 		\subfigure[The AIMD variations that two EWTCP flows with weight $a_1$ and $a_2$ share a single bottleneck link of capacity one.]{
% 			\label{fig:EWTCP}
% 			\includegraphics[width=0.9\textwidth]{figure/EWTCP.pdf}}
% 		\subfigure[The AIMD variations that two ~flows (modify AI phase) with weight $a_1$ and $a_2$ share a single bottleneck link of capacity one.]{
% 			\label{fig:WRenoAI}
% 			\includegraphics[width=0.9\textwidth]{figure/WReno-AI.pdf}}
% 		\subfigure[The AIMD variations of two ~flows (modify MD phase) with weight $a_1$ and $a_2$ share a single bottleneck link of capacity one.]{
% 			\label{fig:WRenoMD}
% 			\includegraphics[width=0.9\textwidth]{figure/WReno-MD.pdf}}
% 	\caption{The two-source AIMD variations comparison using the technique of Chiu and Jain~\cite{chiu1989analysis}.
% Each axis corresponds to the window size of each source that is normalized to a number between 0 and 1 for convenience.
% If the point colored red lies in the blue solid line, this represents that one unit capacity is fully utilized, \ie, the sum of the obtained bandwidth for two flows is equal to one.
% 		If the point colored red lies in the blue dashed line, this indicates that the obtained bandwidth ratio for two flows is $a_1 : a_2$.
% 		The intersection of the blue solid line and dashed line is the optimal point to achieve efficiency and weighted proportionality.
% 	}
% 	\label{fig:AIMD}
% \end{figure}

\section{MulTCP}

MulTCP\cite{crowcroft1998differentiated}同时修改加增乘减机制的加增（AI）部分和乘减（MD）部分以实现加权公平性。对于权重为$w$的流，其加增参数为$w$，乘减参数为$1-\frac{1}{2w}$。一个权重为$w$的MulTCP流发送端的行为可以概括为：
\begin{itemize}
  \item {\bf 加增（Additive Increase）：} $cwnd \leftarrow cwnd + \frac{w}{cwnd}$ \\
  每收到一个ACK，拥塞窗口$cwnd$就增大$\frac{w}{cwnd}$。
  % For each ACK, the congestion window $cwnd$ increases by $\frac{a_i}{cwnd}$.
  \item {\bf 乘减（Multiplicative Decrease）:}
  $ \left\{
  \begin{aligned}
  cwnd & \to \frac{cwnd}{2} & cwnd < ssthresh \\
  cwnd & \to \left( 1 - \frac{1}{2w} \right) \cdot cwnd & otherwise\\
  \end{aligned}
  \right.$ 
  当拥塞窗口$cwnd$大小大于或等于慢启动阈值$ssthresh$时，每探测到一次丢包，窗口大小就减少$\frac{1}{2w} \cdot cwnd$。若窗口大小小于慢启动阈值，则每对于每次丢包，窗口直接减半。
  %For each loss, the window size is cut down by half if $cwnd$ is less than the slow start threshold $ssthresh$. Otherwise, the window size is decreased by $\frac{1}{2 \cdot a_i} \cdot cwnd$.
\end{itemize}
现在，我来解释一下MulTCP的设计思路。如果$n$条使用加增乘减机制的普通TCP流在一条瓶颈链路上互相竞争，则每一条都会获得链路带宽的$\frac{1}{n}$。
因此，如果在该拥塞链路中一条流可以同时模拟$w$条流的行为，也就是使它成为$w$条流聚合而成的流，它将可以获得链路带宽的$\frac{w}{n}$。
基于上述直觉，MulTCP在设计中企图使一条权重为$w$的TCP流的表现与$w$条普通TCP流的聚合一样。
然而这一设想与传统加增乘减机制的直观理解\cite{chiu1989analysis}并不一致。
如图\ref{fig:MulTCP}所示，两条MulTCP流的变化轨迹并不能收敛到加权公平线上，事实上其收敛处与加权公平线相距甚远。
MulTCP的理论分析是基于传统的锯齿模型的，而锯齿模型已经被证实是极其不精确的\cite{alizadeh2011analysis}，所以其理论分析与现实是有偏差的。
此外，启发MulTCP设计的直觉——用一条流来模拟多条流的聚合其实很难在现实中实现。
其主要原因在于当多个丢包发生时，由于理应窗口减半的流的数目无法知悉，发送端很难准确地去测量多条TCP流应当减少的总拥塞窗口值。
我将在第三章中指出MulTCP事实上是无法准确地实现加权公平性的。

\section{EWTCP}

EWTCP仅通过修改加增（AI）部分来实现加权公平性。对于一条权重为$w$的TCP流，EWTCP将AI的参数设定为$w^2$。
一个权重为$w$的MulTCP流发送端的行为可以概括为：
\begin{itemize}
  \item {\bf Additive Increase:} $cwnd \leftarrow cwnd + \frac{w^2}{cwnd}$ \\
  每收到一个ACK，拥塞窗口$cwnd$就增长$\frac{w^2}{cwnd}$。
  % For each ACK, the congestion window $cwnd$ increases by $\frac{w^2}{cwnd}$.
  \item {\bf Multiplicative Decrease:} $cwnd \leftarrow \frac{cwnd}{2}$ \\
  每探测到一次丢包，拥塞窗口就减半。
  % For each loss, the window size is cut down by half.
\end{itemize}

EWTCP又被叫做WAIMD\cite{Honda2009EWTCP}，它对AI部分的修改是源自于一个经典的TCP流带宽测量模型\cite{padhye1998modeling}。
然而，这一模型在计算单次往返时间（RTT）时并没有考虑动态的排队时延，而是使用一个静态估计的平均值来带入公式中。
现在的交换机都是配备了很大的缓冲区的\cite{Jim2012Bufferbloat}，忽视排队时延的动态变化会导致模型严重第偏离实际。
此外，模型中假设一个RTT内任意两个包之间的丢包事件是相互独立的，但是这对于数据中心网络等私有网络环境来说是不符合实际的。
图\ref{fig:EWTCP}也表明了EWTCP的表现与传统的理解是不一致的，其收敛点与最优点也相差甚远。

\section{基于加增乘减的带权拥塞控制算法的基本形式}

仔细观察MulTCP和EWTCP的AIMD算法，其实可以发现它们都只是为加增乘减（AIMD的AI部分或MD部分配置了一个与流权重相关的因子。\cite{bansal2001binomial}中将包括AIMD在内的所有二项式拥塞控制算法做了一个形式化的描述。而对于基于AIMD的拥塞控制算法，我们也在此给出一个形式化的描述。对于一条权重为$w$的TCP流，基于AIMD的带权拥塞控制算法总是呈现出如下的形式：
\begin{itemize}
  \item {\bf Additive Increase:} $cwnd \leftarrow cwnd + \frac{w^\alpha}{cwnd}, \alpha \in \mathbb{R}$ \\
  每收到一个ACK，拥塞窗口$cwnd$就增长$\frac{w^\alpha}{cwnd}$。
  % For each ACK, the congestion window $cwnd$ increases by $\frac{w^2}{cwnd}$.
  \item {\bf Multiplicative Decrease:} $cwnd \leftarrow cwnd (1 - \frac{w^{-\beta}}{2}), \beta \in \mathbb{R}$ \\
  每探测到一次丢包，拥塞窗口就减少$\frac{w^{-\beta}}{2}$。
  % For each loss, the window size is cut down by half.
\end{itemize}
也就是不同的基于AIMD的带权拥塞控制算法其实只是选择了不同的$\alpha$和$\beta$参数。
那么基于\cite{chiu1989analysis}中的抽象模型来分析，其实直觉上最简单有效的带权拥塞控制算法应当为$\alpha=1,\beta=0$的WCC-AI和$\alpha=0,\beta=1$的WCC-MD。
如图\ref{fig:WReno-AI}和\ref{fig:WReno-MD}中所示，WCC-AI和WCC-MD的收敛点都基本位于最优点附近。
此外，WCC-AI与WCC-MD其实可以说是最基本的两种带权拥塞控制算法，MulTCP其实可以看成WCC-AI和WCC-MD的叠加，EWTCP其实可以看成一个WCC-AI使用了真实权重的平方来作为算法权重参数。
为了更全面地考虑基于加增乘减的带权拥塞控制算法，接下来的文章中我也将会把WCC-AI和WCC-MD纳入分析。

\chapter{实验与分析}\label{chapter:analysis}

\begin{figure*}[tp]
	\centering
  \begin{subfigure}{.6\textwidth}
    \centering
		\includegraphics[width=3.2in]{multcp-dynamic.pdf}
    \label{fig:MulTCPPerformance}
    \caption{MulTCP流仿真带宽图}
  \end{subfigure}
  \begin{subfigure}{.6\textwidth}
    \centering
		\includegraphics[width=3.2in]{ewtcp-dynamic.pdf}
    \label{fig:EWTCPPerformance}
    \caption{EWTCP流仿真带宽图}
	\end{subfigure}
  \begin{subfigure}{.6\textwidth}
    \centering
		\includegraphics[width=3.2in]{wrenoai-dynamic.pdf}
    \label{fig:WReno-AIPerformance}
    \caption{WCC-AI流仿真带宽图}
  \end{subfigure}
  \begin{subfigure}{.6\textwidth}
    \centering
		\includegraphics[width=3.2in]{wrenomd-dynamic.pdf}
    \label{fig:WReno-AIPerformance}
    \caption{WCC-MD流仿真带宽图}
	\end{subfigure}
	\caption{四种典型带权拥塞控制算法的仿真结果。紫、黄、红、蓝四种颜色的线分别对应于权重为4，3，2，1的TCP流。}
	\label{fig:Performance}
\end{figure*}


在这章中，首先我将使用NS3仿真器\cite{NS3}对四种典型带权拥塞控制算法进行仿真，并根据仿真结果对它们进行分析。然后，我将会使用一些拟真实验来验证我分析出的一些想法。

\section{仿真实验}

\textbf{环境配置：}
在NS3仿真器中，我将MulTCP，EWTCP，WCC-AI和WCC-MD实现为ns3::TcpNewReno的子类，并在仿真实验中根据需求做出相应的调用。默认情况下，链路的带宽设置为10$Gbps$，链路的传播时延设置为20$\mu s$，交换机缓冲区的大小设置为200$KBytes$，选择ACK选项也默认开启。

\textbf{带权拥塞控制算法确实可以实现差异化带宽分配，但是它们的加权公平性并不完美：}
如图\ref{fig:Performance}所示，即使在动态的流模式中，四种带权拥塞控制算法也都成功地实现了使权重不同的流获得不同份额的带宽，而且四种算法由一个收敛状态转换到另一个收敛状态的速度都很快。
但是，仔细检查图中各条流的带宽可以发现使用MulTCP和EWTCP的实验中，四条流的带宽比并不是等于它们的权重比的。
反倒是WCC-AI和WCC-MD的四条流的带宽比基本接近它们的权重比。
这似乎表明MulTCP和EWTCP不能达到精确的加权公平性，而WCC-AI和WCC-MD可以达到较为精确的加权公平性。
然而，我换了不同的环境参数（如：交换机缓冲区大小，链路时延，链路带宽等），做了多次不同的实验后，发现事实上无论是这四种带权拥塞控制算法中的哪一种，都可以在特定的网络环境下达到精确的加权公平性，但在某些网络环境条件下它们都无法达到精确的加权公平性。
这也意味着，这四种典型的基于加增乘减的带权拥塞控制算法都可以实现流级的差异化带宽分配，但是它们的加权公平性（或者说它们的带宽分配结果）是不完美的。
更为准确地说，它们的加权公平性是会随着网络环境的变化而变化的。
我将会在节\ref{sec:emulation}中更为详细地说明这一点，并给出基于AIMD的带权拥塞控制算法的加权公平性随环境变量变化的规律。

\begin{figure}[ht]
	\begin{subfigure}{.5\textwidth}
    \centering
    \includegraphics[width=2.8in]{bounded.pdf}
    \caption{RWND最大为131$KBytes$}
		\label{fig:BoundedCwnd}
  \end{subfigure}
	\begin{subfigure}{.5\textwidth}
		\centering
    \includegraphics[width=2.8in]{unbounded.pdf}
    \caption{RWND接近无穷大}
		\label{fig:UnbounedCwnd}
  \end{subfigure}
	\caption{接收端窗口大小对加权公平性的影响.}
	\label{fig:EndHostBuffer}
\end{figure}

\textbf{接收端窗口大小也会影响带权拥塞控制的加权公平性：}
在仿真实验中，我发现不仅带宽和时延等典型的网络环境变量会影响加权公平性，接收端窗口（RWND）大小也会影响带权拥塞控制的加权公平性。
以WCC-AI为例，如图\ref{fig:EndHostBuffer}所示，我在仿真器中生成了三条权重分别为1、2、3的流并使它们在一个带宽为1$Gbps$的链路上互相竞争。
图\ref{fig:BoundedCwnd}展示了当RWND被限制在131$KBytes$时三条流的拥塞窗口（CWND）变化。
在三条流的往返时间一致的情况下，三条流的CWND的比值就等同于它们带宽的比值，也就是CWND反映了这三条流的带宽。
可以发现当RWND成为瓶颈，也就是权重较大的流的拥塞窗口会被RWND限制住时，两条权重不一样的流即使最开始获得了不同的带宽，最终也会收敛到二者带宽相等的情况。
图\ref{fig:UnbounedCwnd}展示了当我把RWND调到极大（可以理解为无穷大）时这三条流运行的情况。
可以发现三条流的运行又恢复正常了，当最终收敛时三条流的CWND值接近达到三条流的权重比$1:2:3$，即它们的带宽又满足加权公平性了。

\section{拟真实验}
\label{sec:emulation}

\chapter{总结与讨论}
在本文中，我们使用预处理层-卷积层-循环卷积层-转录层网络来处理手写中文文本识别的问题。这种网络很好地结合了卷积网络和循环网络各自的优势。

\bibliography{reference}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 致谢，应放在结论之后
\begin{acknowledgement}
感谢在实验室度过的两年时光，老师无论在学术还是人生的指导上都对我起到了很大的帮助；师兄师姐小伙伴们的鼓励支持和陪伴是我坚持下去的动力。
\end{acknowledgement}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
